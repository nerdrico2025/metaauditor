Ol√°! Estou com um problema cr√≠tico no meu app Node.js + PostgreSQL + Drizzle ORM.

PROBLEMA: Meu deploy est√° falando com erro "getaddrinfo ENOTFOUND helium" e n√£o consegue migrar dados do banco developer para production.

HIST√ìRICO: O app funcionava normalmente at√© eu pedir para remover o sistema de login. Depois disso, o deploy sempre falha.

DIAGN√ìSTICO: Acredito que existem dados √≥rf√£os no banco sem associa√ß√£o a usu√°rio, e refer√™ncias quebradas ao sistema de auth do Replit que causam o erro "helium".

OBJETIVO: Preciso criar um usu√°rio superadmin "rafael@clickhero.com.br" e associar todos os dados √≥rf√£os a ele, al√©m de limpar refer√™ncias do Replit Auth.

Voc√™ pode me ajudar a resolver isso passo a passo?


---

## üîç PASSO 1 - DIAGN√ìSTICO DO BANCO

**PROMPT 2 - DIAGN√ìSTICO:**
Primeiro, preciso fazer um diagn√≥stico do banco de dados. Crie um script que:

Conecte ao banco PostgreSQL usando a vari√°vel DATABASE_URL
Verifique se existe a tabela 'users' e sua estrutura
Liste todos os usu√°rios existentes
Verifique se existe o usu√°rio "rafael@clickhero.com.br"
Conte quantos registros √≥rf√£os existem nas tabelas principais (campaigns, ads, audits, projects) onde user_id ou owner_id s√£o NULL
Exiba um relat√≥rio completo do diagn√≥stico
Use postgres.js e drizzle-orm para as conex√µes. Salve como 'diagnostic.js' e execute.


---

## üëë PASSO 2 - CRIAR SUPERADMIN

**PROMPT 3 - CRIAR USU√ÅRIO:**
Agora preciso criar o usu√°rio superadmin. Crie um script que:

Conecte ao banco PostgreSQL
Crie a tabela 'users' se n√£o existir com estas colunas:
id (SERIAL PRIMARY KEY)
email (VARCHAR UNIQUE NOT NULL)
password (VARCHAR NOT NULL)
name (VARCHAR)
role (VARCHAR DEFAULT 'user')
is_active (BOOLEAN DEFAULT true)
created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
updated_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
Crie ou atualize o usu√°rio:
Email: "rafael@clickhero.com.br"
Senha: "ClickHero2024!" (use bcrypt hash com salt 12)
Nome: "Rafael - ClickHero Admin"
Role: "superadmin"
is_active: true
Retorne o ID do usu√°rio criado
Use bcrypt para hash da senha
Salve como 'create-superadmin.js' e execute.


---

## üîó PASSO 3 - ASSOCIAR DADOS √ìRF√ÉOS

**PROMPT 4 - ASSOCIAR DADOS:**
Preciso associar todos os dados √≥rf√£os ao superadmin criado. Crie um script que:

Conecte ao banco e busque o ID do usu√°rio "rafael@clickhero.com.br"
Para cada uma dessas tabelas, atualize registros onde o campo de usu√°rio √© NULL:
campaigns (campo: user_id)
ads (campo: user_id)
audits (campo: user_id)
projects (campo: owner_id)
reports (campo: created_by)
Para cada tabela:
Conte quantos registros √≥rf√£os existem
Atualize todos para o ID do superadmin
Exiba quantos foram atualizados
Adicione updated_at = CURRENT_TIMESTAMP
Exiba um resumo total de registros associados
Se alguma tabela n√£o existir, apenas pule e continue com as outras.

Salve como 'associate-data.js' e execute.


---

## üßπ PASSO 4 - LIMPAR REFER√äNCIAS REPLIT

**PROMPT 5 - LIMPEZA:**
Preciso limpar todas as refer√™ncias ao sistema de auth do Replit que causam o erro "helium". Crie um script que:

Conecte ao banco PostgreSQL
Execute estas limpezas (ignore erros se colunas/tabelas n√£o existirem):
Remova colunas: replit_token, replit_user_id, replit_username da tabela users
Delete registros da tabela sessions onde provider cont√©m 'replit'
Delete registros da tabela app_settings onde key cont√©m 'replit' ou 'helium'
Remova qualquer refer√™ncia a 'helium' em configura√ß√µes
Procure no c√≥digo por refer√™ncias a:
"helium"
"replit.com"
"replit auth"
"@replit/auth"
Exiba um relat√≥rio do que foi limpo
Salve como 'cleanup-replit.js' e execute.


---

## üîê PASSO 5 - IMPLEMENTAR AUTENTICA√á√ÉO

**PROMPT 6 - SISTEMA DE AUTH:**
Preciso implementar um sistema de autentica√ß√£o pr√≥prio para substituir o Replit Auth. Crie:

Middleware de autentica√ß√£o (middleware/auth.js):
Fun√ß√£o authenticateToken que verifica JWT
Extrai token do header Authorization
Valida usando JWT_SECRET
Adiciona req.user com dados do usu√°rio
Rota de login (routes/auth.js):
POST /login que recebe email e password
Busca usu√°rio no banco
Compara senha com bcrypt
Gera JWT token com expira√ß√£o 24h
Retorna token e dados do usu√°rio
Atualizar app principal:
Adicione rota /api/auth/login (sem middleware)
Proteja outras rotas com authenticateToken
Adicione rota de teste /api/test (protegida)
Vari√°veis de ambiente necess√°rias:
JWT_SECRET (gere uma chave forte)
DATABASE_URL (j√° existe)
Implemente tudo e teste o login localmente.


---

## ‚úÖ PASSO 6 - VALIDA√á√ÉO FINAL

**PROMPT 7 - VALIDA√á√ÉO:**
Preciso validar se tudo est√° pronto para deploy. Crie um script de valida√ß√£o que:

Conecte ao banco e verifique:
Se o superadmin "rafael@clickhero.com.br" existe com role 'superadmin'
Se n√£o h√° dados √≥rf√£os (user_id NULL) nas tabelas principais
Se a estrutura de autentica√ß√£o est√° completa
Teste o sistema de auth:
Tente fazer login com as credenciais do superadmin
Verifique se o JWT √© gerado corretamente
Teste uma rota protegida
Procure por refer√™ncias restantes:
Busque "helium" em todo o c√≥digo
Busque "replit" em configura√ß√µes
Verifique se n√£o h√° imports do @replit/auth
Exiba um relat√≥rio final:
‚úÖ ou ‚ùå para cada verifica√ß√£o
Status geral: PRONTO PARA DEPLOY ou NECESSITA CORRE√á√ïES
Salve como 'validate-deploy.js' e execute.


---

## üöÄ PASSO 7 - DEPLOY

**PROMPT 8 - EXECUTAR DEPLOY:**
Agora que tudo foi validado, preciso fazer o deploy.

Primeiro, confirme que todas as valida√ß√µes passaram
Verifique se estas vari√°veis de ambiente est√£o configuradas:
DATABASE_URL
JWT_SECRET
NODE_ENV=production
Execute o deploy do app
Ap√≥s o deploy, teste:
Se a URL p√∫blica carrega sem erro
Se o login funciona na vers√£o deployada
Se n√£o h√° mais erro "getaddrinfo ENOTFOUND helium"
Se der erro, mostre os logs completos do deploy
CREDENCIAIS PARA TESTE:

Email: rafael@clickhero.com.br
Senha: ClickHero2024!